---
description: Rule describes the photo processing pipeline: from preprocessing photos, to uploading them to a CDN. Use it when your task involves any of these operations.
alwaysApply: false
---
# Photo Processing Pipeline

This guide explains how to add new photography projects from start to finish.

## Step 1: Add Original Photos

Place photos in `original-photos/Projects/[Project Name]/`
- Use descriptive folder names (e.g., "Kathmandu", "Electronic Brunch")
- Supported formats: `.jpg`, `.jpeg` only
- Photos can be any size; the pipeline handles optimization

## Step 2: Analyze Photos (Optional)

Check which photos need processing:
```bash
npm run analyze-photos
```

This shows:
- Photos larger than 3MB (will be compressed)
- Total size per folder
- Overall statistics

## Step 3: Upload & Process Photos

Upload to Cloudflare R2 (default):
```bash
npm run upload-photos
```

Upload to Vercel Blob (optional):
```bash
npm run upload-photos -- --storage=blob
```

**Options:**
- `--storage=r2` or `--storage=blob` - Choose storage backend (default: r2)
- `--dry-run` - Preview without uploading
- `--overwrite` - Replace existing photos
- `--folder="Project Name"` - Process specific folder only
- `--files="path1,path2,path3"` - Upload specific file(s) only. Use comma-separated paths relative to project root

**Usage Examples:**
```bash
# Upload a single file from Other folder
npm run upload-photos -- --files=original-photos/Other/Meditating.jpg

# Upload multiple files from a project
npm run upload-photos -- --files=original-photos/Projects/Kathmandu/photo1.jpg,original-photos/Projects/Kathmandu/photo2.jpg

# Upload with overwrite flag
npm run upload-photos -- --files=original-photos/Other/photo.jpg --overwrite

# Dry run to preview what would be uploaded
npm run upload-photos -- --files=original-photos/Other/photo.jpg --dry-run
```

**What it does:**
- Compresses images >3MB to ~2.5MB (85% quality)
- Uploads to storage at `photos/Projects/[Project Name]/[filename]`
- Creates manifest file:
  - `scripts/manifests/uploadPhotos.json` for R2 (default)
  - `scripts/manifests/uploadPhotos-blob.json` for Vercel Blob
- Photos are accessible via `NUXT_PUBLIC_CDN_BASE_URL`

**Storage Backend Comparison:**
- **R2**: Better performance, lower costs, custom domains
- **Vercel Blob**: Simpler setup, integrated with Vercel platform

## Step 4: Generate Markdown Files

Create/update project markdown files:
```bash
npm run update-markdown
```

**What it does:**
- Reads manifest file from `scripts/manifests/uploadPhotos.json` (or `uploadPhotos-blob.json`)
- Analyzes aspect ratios (vertical, horizontal, square)
- Creates `content/projects/[slug].md` files
- Preserves existing metadata (title, description, date, location, tags)
- Updates photo list with correct aspect ratios

## Step 5: Edit Project Metadata

Manually edit the generated markdown in `content/projects/`:

```yaml
---
title: 'Project Name'
description: 'Project description'
location: 'City, Country'
date: '2025-01-15'  # Single date
# OR use date range:
# startDate: '2025-01-15'
# endDate: '2025-01-20'
tags: ['travel', 'portrait']  # Available: travel, portrait, landscape, event, etc.
coverPhoto: '/photos/Projects/Project Name/cover.jpg'  # Desktop
coverPhotoMobile: '/photos/Projects/Project Name/mobile.jpg'  # Mobile (optional)
projectRoot: 'Project Name'
photos:
  - fileName: 'photo1.jpg'
    aspectRatio: 'vertical'  # Auto-generated, can adjust if needed
---
```

## Step 6: Test Locally

```bash
npm run dev
```

Navigate to `/projects/[slug]` to verify.

## Step 7: Deploy

Commit and push to trigger Vercel deployment:
```bash
git add .
git commit -m "Add new project: [Project Name]"
git push
```

## Important Notes

- **Don't commit** `original-photos/` folder (gitignored)
- **Don't commit** manifest files: `scripts/manifests/` directory (gitignored)
- Photos are served from CDN storage (Vercel Blob or R2), not from the repo
- Date format: `YYYY-MM-DD` (ISO 8601)
- Aspect ratio threshold: Â±0.1 of 1:1 ratio = square

## Environment Variables

### For Vercel Blob:
```bash
BLOB_READ_WRITE_TOKEN=your_vercel_blob_token
NUXT_PUBLIC_CDN_BASE_URL=https://your-blob-url.public.blob.vercel-storage.com
```

### For Cloudflare R2:
```bash
R2_ACCOUNT_ID=your_r2_account_id
R2_ACCESS_KEY_ID=your_r2_access_key
R2_SECRET_ACCESS_KEY=your_r2_secret_key
R2_BUCKET_NAME=photography-portfolio
R2_PUBLIC_URL=https://your-custom-domain.com  # Optional, defaults to <bucket>.r2.dev
NUXT_PUBLIC_CDN_BASE_URL=https://photography-portfolio.r2.dev  # Or your custom domain
```
